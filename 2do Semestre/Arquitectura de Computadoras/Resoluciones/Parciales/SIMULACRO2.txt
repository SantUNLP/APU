PA EQU 30H
PB EQU 31H
CA EQU 32H
CB EQU 33H

ORG 3000H
FUNCIONR: MOV BX, OFFSET CADENA
PEDIR: INT 6
CMP BYTE PTR [BX], 46
JZ TERMINAR
INC CL
INC BX
JMP PEDIR
TERMINAR: MOV BX, OFFSET CADENA
RET


ORG 3500H
FUNCIONS: MOV BX, OFFSET MENSAJE
MOV AL, OFFSET CADENA - OFFSET MENSAJE
INT 7
RET

ORG 4000H
FUNCIONI: MOV BX, OFFSET CADENA
POLL: CMP BYTE PTR [BX], 46
JZ TERMINEDEIMPRIMIR
MOV AL, [BX]
OUT PB, AL
IN AL, PA
AND AL, 1
JNZ FUNCIONI
CALL STROBE0
CALL STROBE1
INC BX
JMP POLL
TERMINEDEIMPRIMIR: RET

ORG 4200H
STROBE0:
; Strobe = 0
IN AL, PA
AND AL, 0FDh
OUT PA, AL
RET

ORG 4500H
STROBE1:
; Strobe = 1
IN AL, PA
OR AL, 2
OUT PA, AL
RET

ORG 1000H
CHAR DB ?
MENSAJE DB "FIN DEL PROGRAMA"
CADENA DB ?

ORG 2000H
MOV AL, 1
OUT CA, AL
MOV AL, 0
OUT CB, AL
; Configuro PIO para Imnpresora
LEERCAR:
MOV BX, OFFSET CHAR
INT 6
CMP BYTE PTR [BX], 115
JZ FUNCS
CMP BYTE PTR [BX], 114
JZ FUNCR
CMP BYTE PTR [BX], 69h
JZ FUNCI
JMP LEERCAR
FUNCI: CALL FUNCIONI
JMP LEERCAR
FUNCS: CALL FUNCIONS
JMP FINAL
FUNCR: CALL FUNCIONR
JMP LEERCAR
FINAL: INT 0
END